language: ruby
rvm:
  - 2.1.0

env:
  global:
    - APP_NAME=staging-asurmo
    - CI_REPORTS=shippable/testresults COVERAGE_REPORTS=shippable/codecoverage
    - secure: qgtJptoFvuOXpg/wSJXTh5MGjvy91R/6BmQe4j55Q7V+x4N1l8+kf6O71ZAZyfDrwA7ESk5ELUEUgAFvkEaSUlWjAh/VUaJM8HplIX4XM7tJ/cp3G8Euh45gdo/PUhR270yvxv7/8/NQY64OEQGETVF/KfZQrS9Tx9hW1DOcZ0KM4EHYBYm62U95Rwe8yIwfBVC9XJAgygs4cK8fZOe4+W0lIwP7BO/Yx+P92b8yj06j71kxUPGQNH/SRJ/1U/45oJHah5jGlJ+5sFveAYFlLxeIcAUuenI4Xu1FBcFKBD7wCy90YRLVLJy+txk4JlWXq+V2kEF+lR1zVgoIb2w/jg==

before_install:
  - which heroku || wget -qO- https://toolbelt.heroku.com/install-ubuntu.sh | sh

before_script:
  - mkdir -p shippable/testresults
  - mkdir -p shippable/codecoverage
  - psql -c 'create database "sample-rubyonrails-postgres-heroku_test";' -U postgres

after_success:
  - test -f ~/.ssh/id_rsa.heroku || ssh-keygen -y -f ~/.ssh/id_rsa > ~/.ssh/id_rsa.heroku && heroku keys:add ~/.ssh/id_rsa.heroku
  - git remote -v | grep ^heroku || heroku git:remote --ssh-git --app $APP_NAME
  - git push -f heroku $BRANCH:master
  - heroku run rake db:migrate
